<div class="container mt-5">
  <h2 class="text-primary mb-4">Historial de Citas</h2>

  <table class="table table-hover shadow-sm rounded">
    <thead class="table-primary">
      <tr>
        <th>Paciente</th>
        <th>Médico</th>
        <th>Especialidad</th>
        <th>Fecha</th>
        <th>Hora</th>
        <th>Motivo</th>
        <th>Estado</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let cita of historial">
        <td>{{ cita.pacienteInfo?.nombreCompleto }}</td>
        <td>{{ cita.medicoInfo?.nombre }}</td>
        <td>{{ cita.especialidadInfo?.especialidad }}</td>
        <td>{{ cita.fecha | date: 'shortDate' }}</td>
        <td>{{ cita.hora }}</td>
        <td>{{ cita.motivo || 'No especificado' }}</td>
        <td>
          <span class="badge bg-warning text-dark" *ngIf="cita.estado === 'Pendiente'">{{ cita.estado }}</span>
          <span class="badge bg-success" *ngIf="cita.estado !== 'Pendiente'">{{ cita.estado }}</span>
        </td>
        <td>
          <button class="btn btn-sm btn-outline-primary me-1" (click)="editarCita(cita)" *ngIf="cita.estado === 'Pendiente'">
            Editar
          </button>
          <button class="btn btn-sm btn-outline-danger" (click)="abrirConfirmacion(cita._id)" *ngIf="cita.estado === 'Pendiente'">
            Eliminar
          </button>
        </td>
      </tr>
    </tbody>
  </table>

  <!-- Modal Edición -->
  <div class="modal-overlay" *ngIf="citaEditando">
    <div class="modal-content shadow-lg">
      <h5 class="text-center text-primary">Editar Cita</h5>
      <form [formGroup]="formularioEdicion" (ngSubmit)="guardarEdicion()">
        <div class="mb-3">
          <label>Fecha:</label>
          <input type="date" class="form-control" formControlName="fecha">
        </div>
        <div class="mb-3">
          <label>Hora:</label>
          <input type="time" class="form-control" formControlName="hora">
        </div>
        <div class="mb-3">
          <label>Motivo:</label>
          <input type="text" class="form-control" formControlName="motivo">
        </div>
        <div class="mb-3">
          <label>Médico:</label>
          <select class="form-control" formControlName="medico">
            <option *ngFor="let medico of medicos" [value]="medico._id">{{ medico.nombre }}</option>
          </select>
        </div>
        <div class="mb-3">
          <label>Especialidad:</label>
          <select class="form-control" formControlName="especialidad">
            <option *ngFor="let especialidad of especialidades" [value]="especialidad._id">{{ especialidad.nombre }}</option>
          </select>
        </div>
        <div class="d-flex justify-content-end gap-2">
          <button class="btn btn-success" type="submit">Guardar</button>
          <button class="btn btn-outline-secondary" type="button" (click)="cancelarEdicion()">Cancelar</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal Confirmación Eliminación -->
  <div class="modal-overlay" *ngIf="idCitaParaEliminar">
    <div class="modal-content text-center">
      <h5 class="mb-3">¿Estás seguro de eliminar esta cita?</h5>
      <div class="d-flex justify-content-center gap-3">
        <button class="btn btn-danger" (click)="confirmarEliminar()">Sí, eliminar</button>
        <button class="btn btn-outline-secondary" (click)="cancelarEliminar()">Cancelar</button>
      </div>
    </div>
  </div>
</div>
